# 标尺需求分析

## 1 公司需求文档

在开发之前，意派对标尺功能进行了初期的规划



### 1.1 UI 界面

参考 Sketch

针对元素对齐，横竖标注参考方便，可参考 ps 画布操作

![img](https://tva1.sinaimg.cn/large/007S8ZIlgy1gh0rs4y6k5j31hc0qfabp.jpg)



### 1.2 第一阶段

- 标尺功能
  - 用 React 做，用类似 Redux + Backbone 的方式（参考容器的开发模式）
  - TS, React.FC, Hooks, Redux, RxJS
  - 两根标尺的渲染可以考虑用 canvas 画（因为线条较多，且标尺显示部分不需要交互）
- 网格线
  - 基本说明同上
  - 网格线和标尺在组件内部拆开来，相对独立

-------------------------------------------------------------------------------------------

- 重构画布缩放功能（canvasLocator.js、DomLocator.js）
  - 组件化、拆成拆成不同文件、计算部分 TS、补 Jest 测试
  - 功能文件夹也可以换成 `v2_edit/feature`
  - 渲染部分继续用 CSS、可以考虑换成 React
  - 快捷键功能先继续保持简单处理
- 保持缩放率的接口（给别的功能用，比如元素拖放）



### 1.3 第二阶段

- 辅助线功能（待定）
  - 拖放、编辑、元素吸附等功能



### 1.4 2020.6.16 方案

#### 功能需求

- 标尺
  - 编辑器顶部和左侧有标尺参考
  - 可隐藏或显示
- 参考线
  - 有可拉动参考线
  - 可增删参考线
  - 可全部隐藏或显示
- 网格
  - 可隐藏或显示

#### 操作体验

- 参考线拉动流畅（性能）
- 遇到组件边缘有吸附效果（接口）
- 参考线可以更改颜色（接口）

#### 其他产品

1. 专业类工具

   - Ih5：
     - 完全仿 ps，针对画布本身标尺，固定的参考线，在画布区域拉动参考线可复制
     - 不可缩放画布
   - 木疙瘩：
     - 完全仿ps，针对舞台本身标尺，参考线似乎没作用
     - 应该不可缩放画布

2. 模板类工具

   - 易企秀：
     - 针对画布上默认有网格和参考线，点击画布顶部和左侧标尺可添加参考线，拉到最左侧和最顶部可删除，拉动参考线进行移动或删除较吃力，体验不是很好
     - 不可缩放画布

   - 凡科：
     - 功能和操作有点类似易企秀，画布右侧可针对标尺、参考线是否吸附、颜色和显示与隐藏做自定义控制，拉动体验较好
     - 不可缩放画布

   - 人人秀：
     - 只有网格，没有标尺和参考线，但可以显示隐藏网格、颜色、网格密度、垂直和居中参考线和吸附控制
     - 可以通过加减按钮，缩放画布

   - maka：
     - 有网格，没有标尺和参考线
     - 可以通过加减按钮，缩放画布



## 2 需求文档完善

### 2.1 刻度组件「Ruler」

1. 能展示大小刻度线，大刻度是十个小刻度
2. 刻度线起始刻度是画布的左上顶点
3. 选中组件在刻度上有阴影
4. 滚动的时候刻度线起始刻度随之变化
5. 缩放的时候刻度线起始刻度+刻度代表大小随之变化

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ghl9m1vsn1g30g40bcx3q.gif)





### 2.2 参考线组件「GuideLine」

1. 鼠标点击刻度区域，生成一条新的参考线
2. 鼠标可以拖动参考线横/纵向移动，刻度值随之变化
3. 仅在刻度线区域可拖动，标尺组件不可影响内部编辑区域
4. 参考线移动超出区域则予以删除
5. 参考线移动吸附选中组件

总得来说就是实现 `lines` 数组的 `CRUD` 操作

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ghlavmxkbag30g40bctpj.gif)



### 2.3 组件需求/主要功能

1. 鼠标移至刻度线区域，显示渲染单条预览线，预览线拥有预览刻度数值
2. 鼠标在刻度线区域内移动，预览线跟随移动，线侧刻度值随之变化
3. 鼠标移出刻度线区域，不予渲染预览线组件

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ghl9g9g9ksg30g40bcn3q.gif)



## 优先级

1. 数据结构 & 接口
   - 标尺：缩放
     - 参考线：位置（事件？）、样式（颜色、虚实线）
     - 刻度线：位置、刻度、样式（颜色、字体位置、字体）
2. 技术选型
   - canvas or svg ？
3. 功能逻辑
4. 编码实现



